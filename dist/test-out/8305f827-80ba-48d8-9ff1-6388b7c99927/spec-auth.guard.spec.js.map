{
  "version": 3,
  "sources": ["src/app/guards/auth.guard.spec.ts", "src/app/guards/auth.guard.ts"],
  "sourcesContent": ["import { TestBed } from '@angular/core/testing';\r\nimport { CanActivateFn, Router, UrlTree } from '@angular/router';\r\nimport { authGuard } from './auth.guard';\r\nimport { AuthService } from '../services/auth.service';\r\nimport { of } from 'rxjs';\r\n\r\ndescribe('AuthGuard', () => {\r\n    let authServiceSpy: jasmine.SpyObj<AuthService>;\r\n    let routerSpy: jasmine.SpyObj<Router>;\r\n\r\n    const executeGuard: CanActivateFn = (...guardParameters) =>\r\n        TestBed.runInInjectionContext(() => authGuard(...guardParameters));\r\n\r\n    beforeEach(() => {\r\n        const authSpy = jasmine.createSpyObj('AuthService', [], {\r\n            usuario$: of(null) // Default to not logged in\r\n        });\r\n        const rSpy = jasmine.createSpyObj('Router', ['navigate']);\r\n\r\n        TestBed.configureTestingModule({\r\n            providers: [\r\n                { provide: AuthService, useValue: authSpy },\r\n                { provide: Router, useValue: rSpy }\r\n            ]\r\n        });\r\n\r\n        authServiceSpy = TestBed.inject(AuthService) as jasmine.SpyObj<AuthService>;\r\n        routerSpy = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n    });\r\n\r\n    it('should be created', () => {\r\n        expect(executeGuard).toBeTruthy();\r\n    });\r\n\r\n    it('should redirect to /login and return false if not logged in', (done) => {\r\n        // Arrange\r\n        // usuario$ is already null from beforeEach\r\n\r\n        // Act\r\n        const result = executeGuard({} as any, {} as any);\r\n\r\n        // Assert\r\n        if (result instanceof Promise) {\r\n            // Handle promise if needed (though our guard returns Observable)\r\n        } else {\r\n            // Observable\r\n            (result as any).subscribe((res: boolean | UrlTree) => {\r\n                expect(res).toBeFalse();\r\n                expect(routerSpy.navigate).toHaveBeenCalledWith(['/login']);\r\n                done();\r\n            });\r\n        }\r\n    });\r\n\r\n    it('should allow access (return true) if logged in', (done) => {\r\n        // Arrange\r\n        // Mock user logged in\r\n        (Object.getOwnPropertyDescriptor(authServiceSpy, 'usuario$')?.get as jasmine.Spy).and.returnValue(of('testuser'));\r\n\r\n        // Act\r\n        const result = executeGuard({} as any, {} as any);\r\n\r\n        // Assert\r\n        (result as any).subscribe((res: boolean | UrlTree) => {\r\n            expect(res).toBeTrue();\r\n            expect(routerSpy.navigate).not.toHaveBeenCalled();\r\n            done();\r\n        });\r\n    });\r\n});\r\n", "import { inject } from '@angular/core';\r\nimport { CanActivateFn, Router } from '@angular/router';\r\nimport { AuthService } from '../services/auth.service';\r\nimport { map, take } from 'rxjs/operators';\r\n\r\nexport const authGuard: CanActivateFn = () => {\r\n    const auth = inject(AuthService);\r\n    const router = inject(Router);\r\n\r\n    return auth.usuario$.pipe(\r\n        take(1), // nos quedamos con el último valor\r\n        map(usuario => {\r\n            if (usuario) {\r\n                // hay usuario logueado → permite acceso\r\n                return true;\r\n            } else {\r\n                // no hay usuario → lo mandamos al login\r\n                router.navigate(['/login']);\r\n                return false;\r\n            }\r\n        })\r\n    );\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;ACDA;AACA;AACA;AACA;AAEO,IAAM,YAA2B,MAAK;AACzC,QAAM,OAAO,OAAO,WAAW;AAC/B,QAAM,SAAS,OAAO,MAAM;AAE5B,SAAO,KAAK,SAAS;IACjB,KAAK,CAAC;;IACN,IAAI,aAAU;AACV,UAAI,SAAS;AAET,eAAO;MACX,OAAO;AAEH,eAAO,SAAS,CAAC,QAAQ,CAAC;AAC1B,eAAO;MACX;IACJ,CAAC;EAAC;AAEV;;;ADnBA;AACA;AAEA,SAAS,aAAa,MAAK;AACvB,MAAI;AACJ,MAAI;AAEJ,QAAM,eAA8B,IAAI,oBACpC,QAAQ,sBAAsB,MAAM,UAAU,GAAG,eAAe,CAAC;AAErE,aAAW,MAAK;AACZ,UAAM,UAAU,QAAQ,aAAa,eAAe,CAAA,GAAI;MACpD,UAAU,GAAG,IAAI;;KACpB;AACD,UAAM,OAAO,QAAQ,aAAa,UAAU,CAAC,UAAU,CAAC;AAExD,YAAQ,uBAAuB;MAC3B,WAAW;QACP,EAAE,SAAS,aAAa,UAAU,QAAO;QACzC,EAAE,SAAS,QAAQ,UAAU,KAAI;;KAExC;AAED,qBAAiB,QAAQ,OAAO,WAAW;AAC3C,gBAAY,QAAQ,OAAO,MAAM;EACrC,CAAC;AAED,KAAG,qBAAqB,MAAK;AACzB,WAAO,YAAY,EAAE,WAAU;EACnC,CAAC;AAED,KAAG,+DAA+D,CAAC,SAAQ;AAKvE,UAAM,SAAS,aAAa,CAAA,GAAW,CAAA,CAAS;AAGhD,QAAI,kBAAkB,SAAS;IAE/B,OAAO;AAEF,aAAe,UAAU,CAAC,QAA0B;AACjD,eAAO,GAAG,EAAE,UAAS;AACrB,eAAO,UAAU,QAAQ,EAAE,qBAAqB,CAAC,QAAQ,CAAC;AAC1D,aAAI;MACR,CAAC;IACL;EACJ,CAAC;AAED,KAAG,kDAAkD,CAAC,SAAQ;AAG1D,KAAC,OAAO,yBAAyB,gBAAgB,UAAU,GAAG,KAAoB,IAAI,YAAY,GAAG,UAAU,CAAC;AAGhH,UAAM,SAAS,aAAa,CAAA,GAAW,CAAA,CAAS;AAG/C,WAAe,UAAU,CAAC,QAA0B;AACjD,aAAO,GAAG,EAAE,SAAQ;AACpB,aAAO,UAAU,QAAQ,EAAE,IAAI,iBAAgB;AAC/C,WAAI;IACR,CAAC;EACL,CAAC;AACL,CAAC;",
  "names": []
}
