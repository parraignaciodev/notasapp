import{a as i,b as o}from"./chunk-7H446SA7.js";import{g as n}from"./chunk-HWGQXR5V.js";import{e as t}from"./chunk-JHI3MBHO.js";var a=o("CapacitorSQLite",{web:()=>import("./chunk-MPBVYI45.js").then(s=>new s.CapacitorSQLiteWeb),electron:()=>window.CapacitorCustomPlatform.plugins.CapacitorSQLite});var w=(()=>{class s{constructor(){this.db=null,this.sqlite=a}get isNative(){let e=i.getPlatform();return e==="android"||e==="ios"}init(){return t(this,null,function*(){if(this.isNative){try{this.sqlite?.checkConnectionsConsistency&&(this.sqlite.checkConnectionsConsistency.length===0?yield this.sqlite.checkConnectionsConsistency():yield this.sqlite.checkConnectionsConsistency({dbNames:["notasdb"],openModes:["no-encryption"]}))}catch{}try{this.sqlite?.closeAllConnections&&(yield this.sqlite.closeAllConnections())}catch{}if(this.sqlite?.createConnection)this.usesOldCreateSignature()?this.db=yield this.sqlite.createConnection("notasdb",!1,"no-encryption",1,!1):this.db=yield this.sqlite.createConnection({database:"notasdb",version:1,encrypted:!1,mode:"no-encryption",readonly:!1});else throw new Error("CapacitorSQLite.createConnection no est\xE1 disponible");yield this.db.open(),yield this.db.execute(`
      CREATE TABLE IF NOT EXISTS notes(
        id INTEGER PRIMARY KEY NOT NULL,
        titulo TEXT NOT NULL,
        descripcion TEXT,
        color TEXT,
        createdAt TEXT,
        updatedAt TEXT,
        completada INTEGER DEFAULT 0
      );
    `)}})}create(e){return t(this,null,function*(){this.assertDB();let r=yield this.db.run(`INSERT INTO notes (id, titulo, descripcion, color, createdAt, updatedAt, completada)
       VALUES (?, ?, ?, ?, ?, ?, ?)`,[e.id,e.titulo,e.descripcion??"",e.color??"gray",e.createdAt,e.updatedAt,e.completada?1:0]);return this.extractChanges(r)})}update(e){return t(this,null,function*(){this.assertDB();let r=yield this.db.run(`UPDATE notes
         SET titulo=?, descripcion=?, color=?, updatedAt=?, completada=?
       WHERE id=?`,[e.titulo,e.descripcion??"",e.color??"gray",e.updatedAt,e.completada?1:0,e.id]);return this.extractChanges(r)})}delete(e){return t(this,null,function*(){this.assertDB();let r=yield this.db.run("DELETE FROM notes WHERE id=?",[e]);return this.extractChanges(r)})}list(){return t(this,null,function*(){return this.assertDB(),(yield this.db.query("SELECT * FROM notes ORDER BY datetime(updatedAt) DESC")).values??[]})}get(e){return t(this,null,function*(){return this.assertDB(),((yield this.db.query("SELECT * FROM notes WHERE id=?",[e])).values??[])[0]??null})}close(){return t(this,null,function*(){if(this.db){try{yield this.db.close()}catch{}this.db=null}})}usesOldCreateSignature(){try{return typeof this.sqlite.createConnection=="function"&&this.sqlite.createConnection.length>=5}catch{return!1}}assertDB(){if(!this.db)throw new Error("SQLite DB no inicializada. Llama primero a init()")}extractChanges(e){return e?typeof e.changes=="number"?e.changes:e.changes&&typeof e.changes.changes=="number"?e.changes.changes:0:0}static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{w as a};
