import{A as W,B as X,a as F,c as N,e as V,f as R,i as H,j as L,l as M,m as z,n as B,p as J,q as K,s as G,v as q,w as Q}from"./chunk-4TXRC6IA.js";import"./chunk-3UM3HIIS.js";import"./chunk-QUJFQN2Y.js";import"./chunk-XNHTIZJD.js";import"./chunk-ZINMVDVP.js";import"./chunk-7Q4XLJYQ.js";import"./chunk-RKTKMO2W.js";import"./chunk-H473PMB4.js";import"./chunk-VV4OZZV3.js";import"./chunk-QNCTVU3D.js";import"./chunk-54GZX5XS.js";import"./chunk-5BRO6Q2L.js";import"./chunk-GWR6W3C3.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-JPAE2ESC.js";import"./chunk-CKP3SGE2.js";import"./chunk-AFUYUMCB.js";import{a as Y}from"./chunk-WOQIBKY7.js";import"./chunk-6XRCHWW2.js";import{B as _,C as I,M as m,Qa as $,R as T,Ra as k,T as w,Va as j,X as v,Ya as U,Za as D,aa as u,ba as n,ca as o,da as f,f as x,ja as P,ka as d,l,la as E,o as p,q as S,t as g,w as h,wa as s,xa as A,za as O}from"./chunk-APMANMIP.js";import"./chunk-5XPTL2YD.js";import"./chunk-DFETTOGW.js";import"./chunk-3SFUVCX7.js";import"./chunk-DGM7SJPU.js";import"./chunk-DNTR6X5U.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as b,b as C,h as a}from"./chunk-B7O3QC5Z.js";var ee=(()=>{class i{constructor(e){this.storage=e,this._storage=null,this.init()}init(){return a(this,null,function*(){this._storage=yield this.storage.create()})}set(e,t){return a(this,null,function*(){return this._storage?.set(e,t)})}get(e){return a(this,null,function*(){return(yield this._storage?.get(e))??null})}remove(e){return a(this,null,function*(){return this._storage?.remove(e)})}static{this.\u0275fac=function(t){return new(t||i)(h(Y))}}static{this.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var te=(()=>{class i{constructor(e,t){this.http=e,this.storage=t,this.baseUrl="https://jsonplaceholder.typicode.com",this.httpOptions={headers:new U({"Content-Type":"application/json; charset=UTF-8"})},this.cacheKey="api_tareas_cache"}handleError(e){console.error("[API] Error",e);let t="Error desconocido";return e.error instanceof ErrorEvent?t=`Error de red: ${e.error.message}`:t=`Error servidor: ${e.status} - ${e.message}`,x(()=>t)}getTareas(){return this.http.get(`${this.baseUrl}/todos`,this.httpOptions).pipe(p(2),S(e=>a(this,null,function*(){yield this.storage.set(this.cacheKey,e)})),l(e=>a(this,null,function*(){console.warn("[API] Error, intentando leer cache local",e);let t=yield this.storage.get(this.cacheKey);return t?(console.log("[API] Usando datos desde cache local"),t):this.handleError(e)})))}getTarea(e){return this.http.get(`${this.baseUrl}/todos/${e}`,this.httpOptions).pipe(p(2),l(this.handleError))}createTarea(e){return this.http.post(`${this.baseUrl}/todos`,JSON.stringify(e),this.httpOptions).pipe(p(1),l(this.handleError))}updateTarea(e,t){return this.http.put(`${this.baseUrl}/todos/${e}`,JSON.stringify(t),this.httpOptions).pipe(p(1),l(this.handleError))}deleteTarea(e){return this.http.delete(`${this.baseUrl}/todos/${e}`,this.httpOptions).pipe(p(1),l(this.handleError))}static{this.\u0275fac=function(t){return new(t||i)(h(D),h(ee))}}static{this.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function oe(i,y){i&1&&(n(0,"ion-item")(1,"ion-label"),s(2,"Cargando..."),o(),f(3,"ion-spinner",5),o())}function ne(i,y){if(i&1){let e=P();n(0,"ion-item")(1,"ion-checkbox",6),d("ionChange",function(){let r=_(e).$implicit,c=E();return I(c.toggleCompleta(r))}),o(),n(2,"ion-label")(3,"h2"),s(4),o(),n(5,"p"),s(6),o()(),n(7,"ion-button",7),d("click",function(){let r=_(e).$implicit,c=E();return I(c.eliminar(r))}),f(8,"ion-icon",8),o()()}if(i&2){let e=y.$implicit;m(),u("checked",e.completed),m(3),A(e.title),m(2),O("ID: ",e.id," \xB7 user: ",e.userId)}}var Ie=(()=>{class i{constructor(e,t){this.api=e,this.toastCtrl=t,this.tareas=[],this.cargando=!1}ngOnInit(){this.cargar()}cargar(e){return a(this,null,function*(){this.cargando=!0,this.api.getTareas().subscribe({next:t=>{this.tareas=t.slice(0,10),this.cargando=!1,e?.target?.complete()},error:t=>a(this,null,function*(){this.cargando=!1,e?.target?.complete(),(yield this.toastCtrl.create({message:String(t),duration:2500,color:"danger"})).present()})})})}crearDemo(){return a(this,null,function*(){let e={title:"Nueva tarea demo",completed:!1,userId:1};this.api.createTarea(e).subscribe({next:t=>a(this,null,function*(){this.tareas.unshift(t),(yield this.toastCtrl.create({message:"Tarea demo creada (finge en la API)",duration:2e3,color:"success"})).present()}),error:t=>a(this,null,function*(){(yield this.toastCtrl.create({message:String(t),duration:2500,color:"danger"})).present()})})})}toggleCompleta(e){let t=C(b({},e),{completed:!e.completed});e.id&&this.api.updateTarea(e.id,t).subscribe({next:r=>a(this,null,function*(){Object.assign(e,r),(yield this.toastCtrl.create({message:"Estado actualizado (PUT demo)",duration:2e3,color:"medium"})).present()}),error:r=>a(this,null,function*(){(yield this.toastCtrl.create({message:String(r),duration:2500,color:"danger"})).present()})})}eliminar(e){e.id&&this.api.deleteTarea(e.id).subscribe({next:()=>a(this,null,function*(){this.tareas=this.tareas.filter(r=>r.id!==e.id),(yield this.toastCtrl.create({message:"Eliminado (DELETE demo)",duration:2e3,color:"warning"})).present()}),error:t=>a(this,null,function*(){(yield this.toastCtrl.create({message:String(t),duration:2500,color:"danger"})).present()})})}static{this.\u0275fac=function(t){return new(t||i)(T(te),T(W))}}static{this.\u0275cmp=w({type:i,selectors:[["app-api-tareas"]],decls:18,vars:2,consts:[["slot","fixed",3,"ionRefresh"],["lines","full"],["slot","end","size","small",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["slot","start",3,"ionChange","checked"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash"]],template:function(t,r){t&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),s(3,"API: Tareas remotas"),o()()(),n(4,"ion-content")(5,"ion-refresher",0),d("ionRefresh",function(ie){return r.cargar(ie)}),f(6,"ion-refresher-content"),o(),n(7,"ion-list")(8,"ion-item",1)(9,"ion-label")(10,"h2"),s(11,"Demo JSONPlaceholder"),o(),n(12,"p"),s(13,"GET / POST / PUT / DELETE + cache Storage"),o()(),n(14,"ion-button",2),d("click",function(){return r.crearDemo()}),s(15," Crear demo "),o()(),v(16,oe,4,0,"ion-item",3)(17,ne,9,4,"ion-item",4),o()()),t&2&&(m(16),u("ngIf",r.cargando),m(),u("ngForOf",r.tareas))},dependencies:[j,$,k,X,N,V,R,H,L,M,z,B,J,K,G,q,Q,F],encapsulation:2})}}return i})();export{Ie as ApiTareasPage};
